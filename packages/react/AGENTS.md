# Agent Guidelines for @agentuity/react

## Package Overview

React hooks and components for building Agentuity web applications. Provides type-safe hooks for calling agents and WebSocket communication.

## Commands

- **Build**: `bun run build` (compiles for browser target)
- **Typecheck**: `bun run typecheck` (runs TypeScript type checking)
- **Clean**: `bun run clean` (removes dist/)

## Architecture

- **Runtime**: Browser only (uses browser APIs like fetch, WebSocket)
- **Build target**: Browser with ESNext
- **Dependencies**: Requires `@agentuity/core` (workspace dependency)
- **Peer dependencies**: React 18+ or 19+

## Structure

```text
src/
├── index.ts        # Main entry point
├── context.tsx     # AgentuityProvider and AgentuityContext
├── api.ts          # useAPI hook for HTTP calls
├── websocket.ts    # useWebsocket hook for WebSocket
├── eventstream.ts  # useEventStream hook for SSE
├── types.ts        # Type definitions for route registries
├── url.ts          # URL building utilities
└── memo.ts         # JSON memoization utilities
```

## Code Style

- **React hooks** - Follow React hooks conventions
- **TypeScript generics** - Heavy use of generics for type safety
- **Functional components** - All components are functional
- **Context API** - Use React Context for configuration
- **Error boundaries** - Throw errors that can be caught by error boundaries

## Important Conventions

- **Provider required** - All hooks must be used within `AgentuityProvider`
- **Type inference** - Agent types are inferred from generated types (AgentRegistry)
- **Base URL** - Defaults to current origin if not provided
- **WebSocket protocol** - Auto-converts http:// to ws:// and https:// to wss://
- **Serialization** - Automatically handles JSON serialization/deserialization

## Hooks API

### useAPI

```typescript
// GET route - auto-fetches on mount
const { data, isLoading, error, refetch } = useAPI('GET /users');

// POST route - returns invoke function
const { data, invoke, isLoading } = useAPI('POST /users');

// Invoke with data
const result = await invoke({ name: 'Alice' });
```

- GET routes auto-fetch and return `refetch()`
- POST/PUT/PATCH/DELETE routes return `invoke()`
- Supports streaming with `delimiter` and `onChunk`

### useWebsocket

```typescript
const { isConnected, data, send, close, error } = useWebsocket('/ws');
```

- Auto-reconnection on connection loss
- Returns most recent message in `data`, all messages in `messages`
- Type-safe message handlers

### useEventStream

```typescript
const { data, messages, isConnected, connect, disconnect } = useEventStream('/sse');
```

- Server-Sent Events (SSE) support
- Auto-reconnection support

## Generated Types

This package expects `RouteRegistry` types to be augmented by generated code:

```typescript
// Generated by bundler
export interface RouteRegistry {
  'GET /users': { input: void; output: User[]; stream: false };
  'POST /users': { input: CreateUser; output: User; stream: false };
}
```

## Testing

- Test with React Testing Library
- Mock fetch and WebSocket APIs
- Test error boundaries
- Test with and without provider

## Publishing Checklist

1. Run `bun run build` to compile for browser
2. Verify `dist/` contains browser-compatible code (no Node.js APIs)
3. Ensure peer dependencies are correctly specified
4. Must publish **after** @agentuity/core
